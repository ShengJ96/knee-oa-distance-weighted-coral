# Stage 6 ordinal baseline — SigLIP2 So400M NaFlex on Set A∪B
experiment:
  name: stage6_siglip2_ord_coral_set_ab
  seed: 2025
  output_dir: experiments/models/stage6/siglip2_ord_coral/set_ab
  figures_dir: experiments/figures/stage6_siglip2_ord_coral_set_ab
  reports_dir: experiments/reports/stage6_siglip2_ord_coral_set_ab

model:
  registry: foundation_general
  key: siglip2_so400m_patch16_naflex
  params:
    pretrained_name: google/siglip2-so400m-patch16-naflex
    num_classes: 5
    freeze_backbone_epochs: 1
    pool_type: cls
    processor_call_kwargs:
      max_num_patches: 1024
    head:
      type: ordinal
      mode: coral
      dropout: 0.2

data:
  batch_size: 16
  num_workers: 8
  target_size: null
  medical_variant: clahe
  multi_source:
    enabled: true
    sampling: balanced
    datasets:
      - root: dataset/set_a
        weight: 1.0
      - root: dataset/set_b
        weight: 1.0
  augmentation:
    library: torchvision
    variant: advanced
    augment_train: true
    eval_library: torchvision

training:
  epochs: 48
  save_best: true
  save_last: true
  early_stopping_patience: 8
  amp: true
  grad_accum_steps: 3

optimization:
  optimizer: adamw
  learning_rate: 0.00005
  head_learning_rate: 0.0002
  weight_decay: 0.01
  grad_clip_norm: 1.0
  criterion: coral

scheduler:
  name: cosine
  params:
    min_lr: 5.0e-6
    warmup_epochs: 3

evaluation:
  metrics: [accuracy, f1_macro, cohen_kappa]
  attention_viz:
    enable: false
